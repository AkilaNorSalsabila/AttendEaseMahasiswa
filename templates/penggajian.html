<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Absensi</title>

    <!-- Custom fonts for this template -->
    <link href="/static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .modal-header, .modal-body, .modal-footer {
            padding: 15px;
        }
    </style>
        <!-- Tambahkan di bagian <style> -->
        <style>
        /* Style untuk bottom bar */
        #bottomBar {
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        #bottomBar .bg-success, 
        #bottomBar .bg-danger {
            padding: 0.75rem 1.5rem;
        }
        
        /* Animasi saat muncul/hilang */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        
        #bottomBar[style*="display: flex"] {
            animation: fadeIn 0.3s forwards;
        }
        
        #bottomBar[style*="display: none"] {
            animation: fadeOut 0.3s forwards;
        }
        
        /* Style untuk tabel di modal */
        #modalAmbilGaji .table {
            margin-bottom: 0;
        }
        
        #modalAmbilGaji .card {
            margin-bottom: 1rem;
        }
        
        #modalAmbilGaji .card-header {
            padding: 0.5rem 1rem;
        }
    </style>
        <!-- Firebase JS -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>            
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/dashboard">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Admin Dashboard</div>
            </a>
            <hr class="sidebar-divider">
            <li class="nav-item">
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-database"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/dataset">
                    <i class="fas fa-database"></i>
                    <span>Tambah Dataset</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/train">
                    <i class="fas fa-brain"></i>
                    <span>Training Model</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/attendance">
                    <i class="fas fa-list"></i>
                    <span>Karyawan Attendance</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/jadwal_kerja">
                    <i class="fas fa-calendar"></i>
                    <span>Jadwal Kerja</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/penggajian">
                    <i class="fas fa-calendar"></i>
                    <span>Penggajian</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link logout" href="/logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>

        <!-- Content Wrapper -->
        <div class="container-fluid">
            <h1 class="h3 mb-4 text-gray-800 text-center">Data Gaji Karyawan</h1>

            <!-- Form Filter Nama Karyawan + Tanggal -->
            <div class="card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Filter Data</h6>
                </div>
                <div class="card-body">
                    <form method="POST" action="/admin/penggajian" class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label for="nama_karyawan" class="form-label">Nama Karyawan:</label>
                            <select name="nama_karyawan" id="nama_karyawan" class="form-control">
                                <option value="">Semua Karyawan</option>
                                {% for nama in nama_karyawan_list %}
                                    <option value="{{ nama }}" {% if nama == nama_karyawan %}selected{% endif %}>{{ nama }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="tanggal_mulai" class="form-label">Tanggal Mulai:</label>
                            <input type="date" name="tanggal_mulai" id="tanggal_mulai" value="{{ tanggal_mulai }}" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="tanggal_selesai" class="form-label">Tanggal Selesai:</label>
                            <input type="date" name="tanggal_selesai" id="tanggal_selesai" value="{{ tanggal_selesai }}" class="form-control">
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">Filter</button>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#modalGajiDefault">
                                Set Gaji Default
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tabel Absensi -->
            <div class="card shadow mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Daftar Gaji Karyawan  </h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% if attendance_list %}
                        <table class="table table-bordered table-hover align-middle text-center">
                            <thead class="table-primary text-black">
                                <tr>
                                    <th style="width: 50px;"><input type="checkbox" id="checkAll"></th>
                                    <th style="min-width: 100px;">ID Karyawan</th>
                                    <th style="min-width: 150px;">Nama</th>
                                    <th style="min-width: 160px;">Waktu</th>
                                    <th style="min-width: 120px;">Gaji</th>
                                    <th style="min-width: 130px;">Status</th>
                                </tr>
                            </thead>
                            <tbody>                        
                                {% for a in attendance_list %}
                                <tr>
                                    <td>
                                        <input type="checkbox" class="check-item" name="selected[]" 
                                               value="{{ a.id_karyawan }}" 
                                               data-gaji="{{ a.gaji }}">
                                    </td>
                                    <td>{{ a.id_karyawan }}</td>
                                    <td>{{ a.nama }}</td>
                                    <td>
                                        {% if a.timestamp and a.timestamp != '-' %}
                                            {{ a.timestamp.strftime('%Y-%m-%d') }}<br>
                                            <span class="text-muted">{{ a.timestamp.strftime('%H:%M:%S') }}</span>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>                                                                        
                                    <td class="gaji-value" data-status="{{ a.status }}">
                                        Rp {{ '{:,.0f}'.format(a.gaji).replace(',', '.') }}
                                    </td>
                                    <td>Belum di ambil</td>
                                </tr>
                                {% endfor %}
                                <script>
                                    // Fungsi format Rupiah
                                    function formatRupiah(angka) {
                                        return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                                    }

                                    // Variabel global untuk menyimpan data yang dipilih
                                    let selectedEmployeeData = {
                                        id: null,
                                        nama: null,
                                        items: [],
                                        totalGaji: 0
                                    };

                                    // Fungsi untuk memuat data kasbon dari Firebase - UPDATED
                                    async function loadKasbonData(employeeId) {
                                        try {
                                            console.log("Mencoba memuat kasbon untuk ID:", employeeId); // Debug log
                                            
                                            const kasbonRef = firebase.database().ref('kasbon/' + employeeId);
                                            const snapshot = await kasbonRef.once('value');
                                            const kasbonData = snapshot.val();
                                            
                                            console.log("Data kasbon dari Firebase:", kasbonData); // Debug log

                                            // Jika data kasbon ditemukan
                                            if (kasbonData && kasbonData.kasbon !== undefined) {
                                                return {
                                                    total: parseInt(kasbonData.kasbon) || 0,
                                                    items: [{
                                                        tanggal: kasbonData.tanggal || '-',
                                                        jumlah: parseInt(kasbonData.kasbon) || 0,
                                                        keterangan: 'Kasbon ' + (kasbonData.name || employeeId)
                                                    }]
                                                };
                                            }
                                            
                                            return { total: 0, items: [] };
                                        } catch (error) {
                                            console.error("Error loading kasbon data:", error);
                                            return { total: 0, items: [] };
                                        }
                                    }

                                    // Fungsi utama untuk update bottom bar
                                    function updateAksiTerpilih() {
                                        try {
                                            const checkboxes = document.querySelectorAll('.check-item:checked');
                                            const bottomBar = document.getElementById('bottomBar');
                                            
                                            if (!bottomBar) {
                                                console.error("Bottom bar element not found!");
                                                return;
                                            }

                                            let total = 0;
                                            let count = checkboxes.length;
                                            let currentId = null;
                                            let invalidSelection = false;
                                            
                                            // Reset selected data
                                            selectedEmployeeData = {
                                                id: null,
                                                nama: null,
                                                items: [],
                                                totalGaji: 0
                                            };
                                            
                                            checkboxes.forEach(cb => {
                                                const row = cb.closest('tr');
                                                if (!row) return;
                                                
                                                const id_karyawan = row.cells[1].textContent;
                                                const nama = row.cells[2].textContent;
                                                const gaji = parseInt(cb.dataset.gaji) || 0;
                                                
                                                // Validasi ID karyawan
                                                if (currentId === null) {
                                                    currentId = id_karyawan;
                                                    selectedEmployeeData.id = id_karyawan;
                                                    selectedEmployeeData.nama = nama;
                                                } else if (currentId !== id_karyawan) {
                                                    invalidSelection = true;
                                                }
                                                
                                                // Simpan data
                                                selectedEmployeeData.items.push({
                                                    tanggal: row.cells[3].textContent.trim(),
                                                    status: row.cells[5].textContent.trim(),
                                                    gaji: gaji
                                                });
                                                
                                                total += gaji;
                                            });
                                            
                                            selectedEmployeeData.totalGaji = total;
                                            
                                            const totalGajiText = document.getElementById('totalGajiBottom');
                                            const jumlahText = document.getElementById('jumlahTerpilih');
                                            const ambilGajiBtn = bottomBar.querySelector('button');
                                            
                                            if (count > 0) {
                                                bottomBar.style.display = 'flex';
                                                
                                                if (invalidSelection) {
                                                    bottomBar.querySelector('.bg-success').classList.remove('bg-success');
                                                    bottomBar.querySelector('.rounded-pill').classList.add('bg-danger');
                                                    jumlahText.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>Pilih ID karyawan sama';
                                                    totalGajiText.textContent = '';
                                                    if (ambilGajiBtn) {
                                                        ambilGajiBtn.disabled = true;
                                                        ambilGajiBtn.style.display = 'none';
                                                    }
                                                } else {
                                                    bottomBar.querySelector('.rounded-pill').classList.remove('bg-danger');
                                                    bottomBar.querySelector('.rounded-pill').classList.add('bg-success');
                                                    jumlahText.textContent = `${count} Item (${selectedEmployeeData.nama})`;
                                                    totalGajiText.textContent = formatRupiah(total);
                                                    if (ambilGajiBtn) {
                                                        ambilGajiBtn.disabled = false;
                                                        ambilGajiBtn.style.display = 'block';
                                                    }
                                                }
                                            } else {
                                                bottomBar.style.display = 'none';
                                            }
                                        } catch (error) {
                                            console.error("Error in updateAksiTerpilih:", error);
                                        }
                                    }

                                    // Inisialisasi event listeners - UPDATED
                                    function initEventListeners() {
                                        // Checkbox individual
                                        document.querySelectorAll('.check-item').forEach(cb => {
                                            cb.addEventListener('change', updateAksiTerpilih);
                                        });
                                        
                                        // Checkbox "Pilih Semua"
                                        const checkAll = document.getElementById('checkAll');
                                        if (checkAll) {
                                            checkAll.addEventListener('change', function() {
                                                document.querySelectorAll('.check-item').forEach(cb => {
                                                    cb.checked = this.checked;
                                                });
                                                updateAksiTerpilih();
                                            });
                                        }
                                        
                                        // Tombol Ambil Gaji - UPDATED with better error handling
                                        document.addEventListener('click', async function(e) {
                                            if (e.target.closest('#bottomBar button')) {
                                                if (!selectedEmployeeData.id) {
                                                    alert('Pilih karyawan terlebih dahulu');
                                                    return;
                                                }
                                                
                                                console.log("Tombol Ambil Gaji diklik untuk ID:", selectedEmployeeData.id); // Debug log
                                                
                                                try {
                                                    // Isi data modal
                                                    document.getElementById('modalIdKaryawan').textContent = selectedEmployeeData.id;
                                                    document.getElementById('modalNamaKaryawan').textContent = selectedEmployeeData.nama;
                                                    
                                                    // Isi detail gaji
                                                    const detailGajiBody = document.getElementById('detailGaji');
                                                    if (detailGajiBody) {
                                                        detailGajiBody.innerHTML = '';
                                                        selectedEmployeeData.items.forEach(item => {
                                                            detailGajiBody.innerHTML += `
                                                                <tr>
                                                                    <td>${item.tanggal}</td>
                                                                    <td>${item.status}</td>
                                                                    <td>${formatRupiah(item.gaji)}</td>
                                                                </tr>
                                                            `;
                                                        });
                                                        document.getElementById('totalGajiModal').textContent = formatRupiah(selectedEmployeeData.totalGaji);
                                                    }
                                                    
                                                    // Load dan tampilkan data kasbon - UPDATED
                                                    const kasbonData = await loadKasbonData(selectedEmployeeData.id);
                                                    console.log("Kasbon data yang akan ditampilkan:", kasbonData); // Debug log
                                                    
                                                    const detailKasbonBody = document.getElementById('detailKasbon');
                                                    detailKasbonBody.innerHTML = '';
                                                    
                                                    if (kasbonData.items.length === 0) {
                                                        detailKasbonBody.innerHTML = `
                                                            <tr>
                                                                <td colspan="3" class="text-center">Tidak ada data kasbon</td>
                                                            </tr>
                                                        `;
                                                    } else {
                                                        const item = kasbonData.items[0];
                                                        detailKasbonBody.innerHTML = `
                                                            <tr>
                                                                <td>${item.tanggal}</td>
                                                                <td>${formatRupiah(item.jumlah)}</td>
                                                                <td>${item.keterangan}</td>
                                                            </tr>
                                                        `;
                                                    }
                                                    
                                                    // Update total kasbon dan sisa gaji
                                                    document.getElementById('totalKasbonModal').textContent = formatRupiah(kasbonData.total);
                                                    document.getElementById('sisaGajiModal').textContent = 
                                                        `Sisa Gaji: ${formatRupiah(selectedEmployeeData.totalGaji - kasbonData.total)}`;
                                                    
                                                    // Tampilkan modal
                                                    const modal = new bootstrap.Modal(document.getElementById('modalAmbilGaji'));
                                                    modal.show();
                                                    
                                                } catch (error) {
                                                    console.error("Error saat memproses pengambilan gaji:", error);
                                                    alert('Terjadi kesalahan saat memuat data kasbon');
                                                }
                                            }
                                        });
                                        
                                        // Tombol Proses Ambil Gaji - UPDATED
                                        document.getElementById('btnProsesAmbilGaji').addEventListener('click', async function() {
                                            if (!selectedEmployeeData.id) return;
                                            
                                            try {
                                                const totalGaji = selectedEmployeeData.totalGaji;
                                                const totalKasbonText = document.getElementById('totalKasbonModal').textContent;
                                                const totalKasbon = parseInt(totalKasbonText.replace(/[^\d]/g, '')) || 0;
                                                const sisaGaji = Math.max(0, totalGaji - totalKasbon);
                                                
                                                console.log("Mengirim data penggajian:", { // Debug log
                                                    id_karyawan: selectedEmployeeData.id,
                                                    total_gaji: totalGaji,
                                                    total_kasbon: totalKasbon,
                                                    sisa_gaji: sisaGaji
                                                });
                                                
                                                // Kirim data ke server
                                                const response = await fetch('/admin/proses_ambil_gaji', {
                                                    method: 'POST',
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify({
                                                        id_karyawan: selectedEmployeeData.id,
                                                        total_gaji: totalGaji,
                                                        total_kasbon: totalKasbon,
                                                        sisa_gaji: sisaGaji
                                                    })
                                                });
                                                
                                                const data = await response.json();
                                                
                                                if (data.success) {
                                                    alert('Pengambilan gaji berhasil diproses');
                                                    location.reload();
                                                } else {
                                                    throw new Error(data.message || 'Gagal memproses pengambilan gaji');
                                                }
                                            } catch (error) {
                                                console.error('Error:', error);
                                                alert('Error: ' + error.message);
                                            }
                                        });
                                    }

                                    // Jalankan saat DOM siap
                                    document.addEventListener('DOMContentLoaded', function() {
                                        // Pastikan Firebase sudah diinisialisasi
                                        if (!firebase.apps.length) {
                                            const firebaseConfig = {
                                                apiKey: "YOUR_API_KEY",
                                                authDomain: "YOUR_AUTH_DOMAIN",
                                                databaseURL: "YOUR_DATABASE_URL",
                                                projectId: "YOUR_PROJECT_ID",
                                                storageBucket: "YOUR_STORAGE_BUCKET",
                                                messagingSenderId: "YOUR_SENDER_ID",
                                                appId: "YOUR_APP_ID"
                                            };
                                            firebase.initializeApp(firebaseConfig);
                                        }
                                        
                                        initEventListeners();
                                        updateAksiTerpilih();
                                    });
                                </script>                                                                                                 
                            </tbody>
                        </table> 
                        <!-- Setelah </table> -->
                        <div id="bottomBar" class="d-flex fixed-bottom justify-content-center mb-3" style="display: none;">
                            <div class="bg-success text-white rounded-pill shadow p-3 d-flex align-items-center gap-3">
                                <div><strong id="jumlahTerpilih">0</strong> Karyawan Terpilih</div>
                                <div><strong id="totalGajiBottom">Rp 0</strong></div>
                                <button class="btn btn-light btn-sm text-success fw-bold" style="border-radius: 16px;">Ambil Gaji</button>
                            </div>
                        </div>                       
                        {% else %}
                        <div class="alert alert-info">Tidak ada data kehadiran</div>
                        {% endif %}
                    </div>                   
                </div>
            </div>
        </div>
        <!-- Modal Input Gaji Default -->
        <div class="modal fade" id="modalGajiDefault" tabindex="-1" aria-labelledby="modalGajiDefaultLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form id="formGajiDefault" method="POST" action="/admin/penggajian">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalGajiDefaultLabel">Set Gaji Default</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                        </div>
                        <div class="modal-body">
                            <label for="gaji_default" class="form-label">Masukkan Gaji Default (Rp):</label>
                            <input type="number" class="form-control" id="gaji_default" name="gaji_default" 
                                value="{{ gaji_default }}" min="0" required>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-primary">Simpan</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Modal Ambil Gaji -->
        <div class="modal fade" id="modalAmbilGaji" tabindex="-1" aria-labelledby="modalAmbilGajiLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="modalAmbilGajiLabel">Ambil Gaji Karyawan</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Tutup"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h6>ID Karyawan: <span id="modalIdKaryawan" class="fw-bold"></span></h6>
                                <h6>Nama: <span id="modalNamaKaryawan" class="fw-bold"></span></h6>
                            </div>
                            <div class="col-md-6 text-end">
                                <h6>Periode: <span id="modalPeriode" class="fw-bold"></span></h6>
                            </div>
                        </div>
                        
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Rincian Gaji</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Tanggal</th>
                                                <th>Status</th>
                                                <th>Gaji</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detailGaji">
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                        <tfoot class="table-primary">
                                            <tr>
                                                <th colspan="2">Total Gaji</th>
                                                <th id="totalGajiModal">Rp 0</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Rincian Kasbon</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Tanggal</th>
                                                <th>Jumlah</th>
                                                <th>Keterangan</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detailKasbon">
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                        <tfoot class="table-primary">
                                            <tr>
                                                <th colspan="1">Total Kasbon</th>
                                                <th id="totalKasbonModal">Rp 0</th>
                                                <th id="sisaGajiModal">Sisa Gaji: Rp 0</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                        <button type="button" id="btnProsesAmbilGaji" class="btn btn-primary">Proses Ambil Gaji</button>
                    </div>
                </div>
            </div>
        </div>
    </div>              
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
    // Fungsi untuk memuat gaji default dari Firebase saat modal dibuka
    document.getElementById('modalGajiDefault').addEventListener('show.bs.modal', function () {
        // Ambil gaji default dari Firebase
        const gajiDefaultRef = firebase.database().ref('default_gaji/default');
        gajiDefaultRef.once('value').then((snapshot) => {
            const gajiDefault = snapshot.val() ? snapshot.val().gaji : 10000;
            document.getElementById('gaji_default').value = gajiDefault;
        });
    });
    // Real-time listener untuk perubahan gaji default
    const gajiDefaultRef = firebase.database().ref('default_gaji/default');
    gajiDefaultRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            // Update semua nilai gaji di tabel yang sesuai
            document.querySelectorAll('.gaji-value').forEach(el => {
                const status = el.getAttribute('data-status');
                el.textContent = formatRupiah(status === 'Hadir' ? data.gaji : 0);
            });
        }
    });
</script>
</html>